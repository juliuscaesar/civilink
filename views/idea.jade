extends layout

block content
  
  ol.breadcrumb.bar-white
    li #[a(href='/community/#{data.community.id}') #{data.community.name}]
    li Projects
    li.active #{data.title}
  

  .content-box
      .headertext1 #{data.title}
      p #{data.desc}
      p Organizer: #[a(href='/profile/#{data.user.username}') #{data.user.firstName} #{data.user.lastName}]
  if user
    if (data.user.id == user.id)
      .content-box
        .headertext2 Manage Project
        hr
        p
          a(href='/idea/#{data.id}/create-task') Create Task

  .content-box
    .headertext2 Tasks
    if (tasks.length == 0)
      p There are no tasks for this project yet.
    - var y = 1
    each item in tasks
      hr
      .row
        .col-xs-1.col-sm-1.col-md-1
          h4
            center
              b #{y}
        .col-xs-7.col-sm-8.col-md-9
          h4 #{item.title}
          p #{item.desc}
          if (item.status.length != item.needed)
            p Users assigned: #{item.assigned.length+item.status.length}/#{item.needed} &middot; Points offered: #{item.points}

          if item.assigned.length > 0
            each person in item.assigned
              .col-sm-3.col-md-3
                .thumbnail
                  .caption
                    center
                      if person.avatar
                        img(src="/images/uploads/#{person.avatar}" class='img-circle' height='64px' width='64px')
                      else
                        img(src="/images/anon.gif" class='img-circle' height='64px' width='64px')
                      br
                      a(href='/profile/#{person.username}') #{person.firstName} #{person.lastName}
                      br
                      small   @#{person.username}

        .col-xs-4.col-sm-3.col-md-2
          // if logged in
          if user
            // if the task is marked complete
            if (item.status.length == item.needed)
              center
                b.text-success Completed!
            else
              // If i'm a member of this community
              if (data.community.members.toString().indexOf(user.id) != -1)
                // if I've already completed this task
                if (item.status.toString().indexOf(user.id) != -1)
                  center
                    form.form-horizontal()
                      .form-group
                        button.btn.disabled.btn-sm(type='button') Awarded
                else
                  // if this task is full and i'm NOT assigned.
                  if (item.assigned.length == item.needed && item.assigned.toString().indexOf(user.id) == -1)
                    center
                      form.form-horizontal()
                        .form-group
                          button.btn.disabled.btn-sm(type='button') Assignment full
                  else
                    if (item.assigned.toString().indexOf(user.id) != -1)
                      center
                        form.form-horizontal(class='form-supportidea', action='/tasks/#{item.id}/unassign', method='POST')
                          .form-group
                            button.btn.btn-danger.btn-sm(type='submit') Unassign me
                    else
                      center
                        form.form-horizontal(class='form-supportidea', action='/tasks/#{item.id}/assign', method='POST')
                          .form-group
                            button.btn.btn-success.btn-sm(type='submit') Assign me


// feedback and discussion/comments
// updates from admins